<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>sandow</title>
    <description>sandow&#39;s personal weblog, on coding or such stuff</description>
    <link>//</link>
    <atom:link href="//feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Mon, 09 Nov 2015 20:43:14 +0800</pubDate>
    <lastBuildDate>Mon, 09 Nov 2015 20:43:14 +0800</lastBuildDate>
    <generator>Jekyll v3.0.0</generator>
    
      <item>
        <title>vim常用操作</title>
        <description>&lt;h1 id=&quot;vim语法总结&quot;&gt;VIM语法总结&lt;/h1&gt;

&lt;p&gt;&lt;strong&gt;命令模式下的编辑&lt;/strong&gt;&lt;/p&gt;

&lt;table&gt;&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align: center&quot;&gt;语法&lt;/th&gt;
&lt;th style=&quot;text-align: left&quot;&gt;描述&lt;/th&gt;
&lt;th style=&quot;text-align: center&quot;&gt;语法&lt;/th&gt;
&lt;th style=&quot;text-align: left&quot;&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;：wq!&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;强制保存&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;：q!&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;强制退出不保存&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;:set nu&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;显示行号&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;:set nonu&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;取消显示行号&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;u&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;undo&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;ctrl + r&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;redo&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;.&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;重复前面命令&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;2.&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;重复前面命令2次&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;dd&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;向下删除一行&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;2dd&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;删除两行&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;dt\&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;删除行之后内容直到遇到“\”&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;ye或 yw&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;从当前位置拷贝到本单词的最后一个字符&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;gu(gU)&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;换成小写(大写)字母&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;&lt;strong&gt;如何移动&lt;/strong&gt;&lt;/p&gt;

&lt;table&gt;&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align: center&quot;&gt;语法&lt;/th&gt;
&lt;th style=&quot;text-align: left&quot;&gt;描述&lt;/th&gt;
&lt;th style=&quot;text-align: center&quot;&gt;语法&lt;/th&gt;
&lt;th style=&quot;text-align: left&quot;&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;w&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;移动到单词开头&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;e&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;移动到单词结尾&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;gg&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;移动到的第一行&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;G&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;移动到最后一行&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;0&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;移动到行的开头&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;$&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;动到行的结尾&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;^&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;移动到行的开头非blank字符&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;g_&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;动到行的结尾非blank字符&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;fa&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;到下一个a出现的位置&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;3fa&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;第3次出现a的位置&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;2g&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;移动到第二行&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;%&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;匹配括号移动，包括 (, {, [.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;*&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;匹配光标当前所在单词移到到下一个匹配到的单词&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;#&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;移动到上一个匹配到的单词&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;/patten&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;搜索，按n继续向下搜索&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;N&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;按N继续向上搜索&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;ctrl + o 跳到上一次修改的地方&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/word_moves.jpg&quot; alt=&quot;word_moves&quot;&gt;
&lt;img src=&quot;/images/line_moves.jpg&quot; alt=&quot;line_moves&quot;&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;以什么样的形式进入插入模式&lt;/strong&gt;&lt;/p&gt;

&lt;table&gt;&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align: center&quot;&gt;语法&lt;/th&gt;
&lt;th style=&quot;text-align: left&quot;&gt;描述&lt;/th&gt;
&lt;th style=&quot;text-align: center&quot;&gt;&lt;/th&gt;
&lt;th style=&quot;text-align: center&quot;&gt;语法&lt;/th&gt;
&lt;th style=&quot;text-align: left&quot;&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;A&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;移动到行未并进入插入模式&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;x&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;删除光标所在位置的字符&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;I&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;移到到行首并进入插入模式&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;X&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;删除光标所在位置之前的字符&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;o&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;在当前行之后新建一行并进入插入模式&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;&lt;strong&gt;区域选择&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;其格式为 &lt;code&gt;&amp;lt;action&amp;gt;a&amp;lt;object&amp;gt;&lt;/code&gt; 和 &lt;code&gt;&amp;lt;action&amp;gt;i&amp;lt;object&amp;gt;&lt;/code&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;action可以是任何的命令，如 d (删除), y (拷贝), v (可以视模式选择)。&lt;/li&gt;
&lt;li&gt;object 可能是： w 一个单词， W 一个以空格为分隔的单词， s 一个句字， p 一个段落。也可以是一个特别的字符：&amp;quot;、 &amp;#39;、 )、 }、 ]。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;举例： &lt;code&gt;daw&lt;/code&gt; 删除一个单词&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;块操作&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;命令模式下按 &lt;strong&gt;ctrl + v&lt;/strong&gt; 移动光标选中需要修改的行（区域），
然后按&lt;strong&gt;x&lt;/strong&gt; 或者 &lt;strong&gt;d&lt;/strong&gt; 删除该内容&lt;/p&gt;

&lt;p&gt;批量在行首增加内容：
 &lt;code&gt;ctrl + v&lt;/code&gt; &amp;gt;&amp;gt; &lt;code&gt;0&lt;/code&gt; &amp;gt;&amp;gt; &lt;code&gt;I&lt;/code&gt; &amp;gt;&amp;gt; 写下想增加的内容 &amp;gt;&amp;gt;&lt;code&gt;Esc&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/rectangular-blocks.gif&quot; alt=&quot;rectangular-blocks&quot;&gt;&lt;/p&gt;

&lt;p&gt;批量在行尾增加内容：&lt;/p&gt;

&lt;p&gt;&lt;code&gt;ctrl + v&lt;/code&gt; &amp;gt;&amp;gt; &lt;code&gt;$&lt;/code&gt; &amp;gt;&amp;gt; &lt;code&gt;A&lt;/code&gt; &amp;gt;&amp;gt; 写下想增加的内容 &amp;gt;&amp;gt;&lt;code&gt;Esc&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;块移动  &lt;code&gt;&amp;lt;&lt;/code&gt; , &lt;code&gt;&amp;gt;&lt;/code&gt; 左右缩进 。 &lt;code&gt;=&lt;/code&gt; 自动给缩进。 &lt;/p&gt;

&lt;p&gt;&lt;strong&gt;自动补全&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;vim 下在编辑模式下也有自动补全功能便不是tab键，而是 &lt;code&gt;ctrl + n&lt;/code&gt;， &lt;code&gt;ctrl + p&lt;/code&gt; 如果匹配到多个可以按多次来找到自己想要的单词&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;宏录制&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;qa&lt;/code&gt;  开始录制宏，并把宏的名字取名为a
&lt;code&gt;q&lt;/code&gt;  停止录制宏
&lt;code&gt;@a&lt;/code&gt;  用@来调用宏并执行
&lt;code&gt;@@&lt;/code&gt;  快捷的执行最新操作的宏&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/macros.gif&quot; alt=&quot;macros&quot;&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;qa&lt;/code&gt;  &amp;gt;&amp;gt;&lt;code&gt;Y&lt;/code&gt; &amp;gt;&amp;gt; &lt;code&gt;p&lt;/code&gt; &amp;gt;&amp;gt; &lt;code&gt;ctrl + a&lt;/code&gt; &amp;gt;&amp;gt; &lt;code&gt;q&lt;/code&gt; &amp;gt;&amp;gt; &lt;code&gt;@a&lt;/code&gt; &amp;gt;&amp;gt; &lt;code&gt;100@@&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;最后来一张图，基本的语法就完全OK了&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/Vim-mindmap.png&quot; alt=&quot;vim-midmap&quot;&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;结语&lt;/strong&gt;：不论什么命令都可以在前面加数字来表示重复n次该命令&lt;/p&gt;
</description>
        <pubDate>Mon, 09 Nov 2015 00:00:00 +0800</pubDate>
        <link>//linux/vim</link>
        <guid isPermaLink="true">//linux/vim</guid>
        
        <category>linux</category>
        
        
        <category>linux</category>
        
      </item>
    
      <item>
        <title>rsync + inotify 实现实时同步</title>
        <description>&lt;h1 id=&quot;主机规划&quot;&gt;主机规划&lt;/h1&gt;

&lt;table&gt;&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align: center&quot;&gt;服务器&lt;/th&gt;
&lt;th style=&quot;text-align: center&quot;&gt;外网IP&lt;/th&gt;
&lt;th style=&quot;text-align: center&quot;&gt;外网VIP&lt;/th&gt;
&lt;th style=&quot;text-align: left&quot;&gt;内网IP&lt;/th&gt;
&lt;th style=&quot;text-align: center&quot;&gt;主机名称&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;A1-nginx 负载服务器&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;10.0.0.5/24&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;10.0.0.3&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;127.16.1.5/24&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;lb01&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;A2-nginx 负载服务器&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;10.0.0.6/24&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;10.0.0.3&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;127.16.1.6/24&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;lb02&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;B1-apache软件web服务器&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;10.0.0.7/24&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;127.16.1.7/24&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;web02&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;B2-apache软件web服务器&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;10.0.0.8/24&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;127.16.1.8/24&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;web01&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;C3-My Sql 数据库服务器&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;&lt;code&gt;10.0.0.51/24&lt;/code&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;127.16.1.51/24&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;Db01&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;C1-NFS 存储服务器&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;&lt;code&gt;10.0.0.31/24&lt;/code&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;127.16.1.31/24&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;NFS01&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;C2-rsync 数据库服务器&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;&lt;code&gt;10.0.0.41/24&lt;/code&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;127.16.1.41/24&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;Backup&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;X-管理服务器&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;&lt;code&gt;10.0.0.61/24&lt;/code&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;127.16.1.61/24&lt;/td&gt;
&lt;td style=&quot;text-align: center&quot;&gt;m01&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;提示： 灰色仅为虚拟机中测试所用，在机房根据实际需求配置&lt;/p&gt;

&lt;h2 id=&quot;克隆虚拟机并配置网卡&quot;&gt;克隆虚拟机并配置网卡&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;编辑eth0的配置文件：&lt;code&gt;vi /etc/sysconfig/network-scripts/ifcfg-eth0&lt;/code&gt;，删除HWADDR地址那一行及UUID的行如下：&lt;/p&gt;

&lt;p&gt;HWADDR=00:0c:29:08:28:9f&lt;br&gt;
UUID=cee39dbb-6a10-4425-9daf-768b6e79a9c9&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;清空 /etc/udev/rules.d/70-persistent-net.rules&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;重启&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;rsync-数据库服务器&quot;&gt;RSYNC 数据库服务器&lt;/h2&gt;

&lt;p&gt;rsync, (remote synchronize) 是一个实现同步功能的软件，它在同步文件的同时，可以保持原来文件的权限，时间，软硬链接等附加信息。 rsync是用rsync 算法提供了一个客户机和远程文件服务器的文件同步的快速方法，而且可以通过ssh方式来传输文件，这样保密也非常好。主要用于远程数据备份与同步。 可以实现全备及增量备份，也可以本地数据同步。 在Centos5中rsync的版本是2.X，是把所有文件比对一遍后进行同步。在CentOs6中rsync的版本是3.0，是一边比对差异一边进行同步。而这里我们用的是3.0&lt;/p&gt;

&lt;p&gt;首先检查rsync看是否安装，及安装的版本&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[root@backup ~]$ rpm -qa rsync
rsync-3.0.6-12.el6.x86_64
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;rsync有三种模式，分别是本地，ssh远程同步，daemon模式&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Local:  &lt;code&gt;rsync [OPTION...] SRC... [DEST]&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Access via remote shell:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Pull: &lt;code&gt;rsync [OPTION...] [USER@]HOST:SRC... [DEST]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Push: &lt;code&gt;rsync [OPTION...] SRC... [USER@]HOST:DEST&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Access via rsync daemon:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Pull: &lt;code&gt;rsync [OPTION...] [USER@]HOST::SRC... [DEST]&lt;/code&gt;
        &lt;code&gt;rsync [OPTION...] rsync://[USER@]HOST[:PORT]/SRC... [DEST]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Push: &lt;code&gt;rsync [OPTION...] SRC... [USER@]HOST::DEST&lt;/code&gt;
       &lt;code&gt;rsync [OPTION...] SRC... rsync://[USER@]HOST[:PORT]/DEST&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;都是把SRC的数据同步到DEST. 如果没有DEST，但会把SRC的文件列出来而不copy&lt;/p&gt;

&lt;p&gt;rsync 参数说明：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;--delete;     delete extraneous files from dest dirs 删除目标文件中多余的文件&lt;/li&gt;
&lt;li&gt;--exclude=PATTERN ;      exclude files matching PATTERN 排除特定文件 --exclude={a,b}&lt;/li&gt;
&lt;li&gt;--exclude-from=FILE;     read exclude patterns from FILE  ,--exclude-from=/tmp/exclude.txt&lt;/li&gt;
&lt;li&gt;-z, --compress    ;          compress file data during the transfer&lt;/li&gt;
&lt;li&gt;-v, --verbose               increase verbosity&lt;/li&gt;
&lt;li&gt;-a, --archive               archive mode; equals -rlptgoD (no -H,-A,-X)&lt;/li&gt;
&lt;li&gt;--bwlimit=KBPS          limit I/O bandwidth; KBytes per second &lt;/li&gt;
&lt;li&gt;--partial               keep partially transferred files 断点续传&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;#排除单个文件：
rsync -auvrtzopgP --progress --exclude=a /backup/ rsync_backup@172.16.1.41::backup --password-file=/etc/rsync.password

#排除多个文件：
rsync -avz --exclude={a,b} /backup/ rsync_backup@172.16.1.41::backup --password-file=/etc/rsync.password

rsync -avz --exclude-from=paichu.log /backup/ rsync_backup@172.16.1.41::backup --password-file=/etc/rsync.password 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;本地备份&quot;&gt;本地备份&lt;/h3&gt;

&lt;p&gt;本地 模式，相当于copy 或者rm
比如
&lt;code&gt;
$ rsync -auvrtzopgP /tmp/ /backup/
&lt;/code&gt;
此命令就会把tmp目录下的文件全部复制到backup目录下面， 如果加上&lt;code&gt;--delete&lt;/code&gt;，此参数的意思是把目标目录与源目录同步，当目标目录里有多于源目录的文件就会删除，也就是源目录是啥样，目标目录就是啥样。如果源目录为空，目标目录也会被清空。我们一般都会在目录后面加&lt;code&gt;/&lt;/code&gt;意思是目录下面，如果不加就直接把目录复制过去了，在远程的时候也是一样的。&lt;/p&gt;

&lt;p&gt;保持属性： -avz  相当于 cp -rp&lt;/p&gt;

&lt;h3 id=&quot;通过shell远程传输-remote&quot;&gt;通过shell远程传输(remote)&lt;/h3&gt;

&lt;p&gt;远程拷贝；相当于ssh带的scp命令，但又优于scp命令的功能。scp每次都是全量拷贝。rsync可以增量拷贝。 当源路径，或目的路径后面包含一个卡号&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;$ rsync -avz -e &amp;#39;ssh -p 22&amp;#39; root@172.16.1.41:/tmp/ /tmp/
The authenticity of host &amp;#39;172.16.1.41 (172.16.1.41)&amp;#39; can&amp;#39;t be established.
RSA key fingerprint is 97:b9:1f:95:8b:7d:ae:59:27:4a:d4:b3:98:ae:c1:77.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added &amp;#39;172.16.1.41&amp;#39; (RSA) to the list of known hosts.
root@172.16.1.41&amp;#39;s password: 
receiving incremental file list
created directory /temp
./
hosts
.ICE-unix/

sent 37 bytes  received 184 bytes  9.02 bytes/sec
total size is 220  speedup is 1.00
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;此命令便是把ip为172.16.1.41的主机里tmp目录下的文件传到本地的/tmp/下。这里 &lt;code&gt;ssh -p 22&lt;/code&gt;命令用于指定端口，默认就是22，-e 这个参数可以不写直接 &lt;code&gt;rsync -avz root@172.16.1.41:/tmp/ /tmp/&lt;/code&gt;便可以把41的文件复制过来。且这里是交互式，手动备份与推送，十分不方便。&lt;/p&gt;

&lt;p&gt;这里有个问题，如果我们用其它用户推或者拉，的时候需要共享文件的所属主与所属组都对该用户对应&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[root@NFS tmp]$ rsync -avz /data/ sandow@172.16.1.41:/data/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;此命令是把本地data目录下的文件推到服务器IP为：41下的data目录下。这里两个data目录都要具有对应主机用户的读取执行写入权限，最好的办法就是把该目录的所属主，所属组改为对应的用户&lt;/p&gt;

&lt;h3 id=&quot;daemon-模式，&quot;&gt;daemon 模式，&lt;/h3&gt;

&lt;p&gt;daemon模式需要配置文件，使用&lt;code&gt;rsync --daemon&lt;/code&gt;启动进程，使用独立的进程方式传输文件，默认端口是873。&lt;/p&gt;

&lt;p&gt;这里需要两台服务器做测试环境，服务器端名为backup, ip为172.16.1.41主要用于存放数据. 客户端(NFS01)IP为172.16.1.31 主要用于向服务器推送（备份）拉回（还原）数据。然后结合crontab实现实时自动备份同步。 &lt;/p&gt;

&lt;h4 id=&quot;服务端的配置&quot;&gt;服务端的配置&lt;/h4&gt;

&lt;p&gt;首先我们来配置rsync的主配置文件 rsyncd.conf，默认情况下该文件不存在需要创建，我们也可以使用&lt;code&gt;man rsyncd.conf&lt;/code&gt;来查看主配置文件里的参数与说明。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;root&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;backup&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cat&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;etc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rsyncd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conf&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#Rsync server&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#created by sandow at 2015-11-05&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#rsyncd.conf start#&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;uid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rsync&lt;/span&gt;     &lt;span class=&quot;c1&quot;&gt;//相当于nfsnobody 客户端连过来具备什么样的权限默认是不存在的&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rsync&lt;/span&gt;     &lt;span class=&quot;c1&quot;&gt;//相当于nfsnobody&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;chroot&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;no&lt;/span&gt;     &lt;span class=&quot;c1&quot;&gt;//   程序出现问题就会开启 开启给个空目录就行&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;max&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;connections&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt;       &lt;span class=&quot;c1&quot;&gt;//客户端连接数 可以同时&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;timeout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;300&lt;/span&gt;        &lt;span class=&quot;c1&quot;&gt;//超时 这是服务端 客户端连过来最多多久后就断掉&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;strict&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;modes&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;yes&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;873&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;pid&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rstbcd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pid&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;//PID就是进程号唯一标识进程,进程号放文件里面&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;lock&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lock&lt;/span&gt;     &lt;span class=&quot;c1&quot;&gt;//锁文件&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;log&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rsyncd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;      &lt;span class=&quot;c1&quot;&gt;//日志文件，出问题在这里看&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;hosts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;allow&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;172.16.1.0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;24&lt;/span&gt;     &lt;span class=&quot;c1&quot;&gt;//允许ip&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;hosts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;deny&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.0.0.0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;     &lt;span class=&quot;c1&quot;&gt;//拒绝&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;secrets&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;etc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;password&lt;/span&gt;      &lt;span class=&quot;c1&quot;&gt;//存放用户和密码文件&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;backup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;        &lt;span class=&quot;c1&quot;&gt;//模块，调用下面服务&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;comment&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;backup&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;server&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;by&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;liuchunhao&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;at&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2015&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;11&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mo&quot;&gt;05&lt;/span&gt;       &lt;span class=&quot;c1&quot;&gt;//注释&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;backup&lt;/span&gt;      &lt;span class=&quot;c1&quot;&gt;//共享目录&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;read&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;only&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;       &lt;span class=&quot;c1&quot;&gt;//可读写&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ignore&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;errors&lt;/span&gt;       &lt;span class=&quot;c1&quot;&gt;//忽略错误&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;auth&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;users&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rsync_backup&lt;/span&gt;       &lt;span class=&quot;c1&quot;&gt;//远程连接的用户，虚拟用户和系统用户没关系&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rsync_backup&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rsync_backup&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;        &lt;span class=&quot;c1&quot;&gt;//不让远程列表，不让看服务端有什么&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;secrets&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;etc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;password&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;配置好rsyncd.conf后便接下来就可以创建对应用户、目录与密码文件&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[root@backup ~]$ useradd rsync -s /sbin/nologin -M
[root@backup ~]$ id rsync
uid=504(rsync) gid=504(rsync) groups=504(rsync)
[root@backup ~]$ mkdir -p /backup
[root@backup ~]$ chown -R rsync.rsync /backup/
[root@backup ~]$ ls -ld /backup/              
drwxr-xr-t. 3 rsync rsync 4096 Nov 12 06:53 /backup/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;创建密码文件，并且修改属性为600&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[root@backup ~]$ echo &amp;quot;rsync_backup:oldboy&amp;quot; &amp;gt;/etc/rsync.password
[root@backup ~]$ cat /etc/rsync.password
rsync_backup:oldboy
[root@backup ~]$ chmod 600 /etc/rsync.password
[sandow@backup ~]$ ll /etc/rsync.password       
-rw------- 1 root root 20 11月  6 16:12 /etc/rsync.password
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;修改/etc/xinetd.d/rsync 文件，把disable 改为no,这应该是最新版本的linux才会有此文件。所以没有的可以不配置&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;cp&quot;&gt;# default: off&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;# description: The rsync server is a good addition to an ftp server, as it \&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#   allows crc checksumming etc.&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;service&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rsync&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;disable&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;no&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;flags&lt;/span&gt;       &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IPv6&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;socket_type&lt;/span&gt;     &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stream&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;wait&lt;/span&gt;            &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;no&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;            &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;root&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;server&lt;/span&gt;          &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;usr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bin&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rsync&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;server_args&lt;/span&gt;     &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;daemon&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;log_on_failure&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;USERID&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;配置好后便可以启动rsync daemon守护进程了&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[sandow@backup tmp]$ rsync --daemon

[sandow@backup tmp]$ ps -ef|grep rsync |grep -v grep
root       2370      1  0 01:57 ?        00:00:00 rsync --daemon

[sandow@backup tmp]$ netstat -lntup|grep rsync
tcp        0      0 0.0.0.0:873                 0.0.0.0:*                   LISTEN      2370/rsync          
tcp        0      0 :::873                      :::*                        LISTEN      2370/rsync   
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;然后让rsync开机自动启动：&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;echo &amp;quot;/usr/bin/rsync --daemon&amp;quot; &amp;gt;&amp;gt;/etc/rc.local
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这里需要注意的是要让端口873通过防火墙&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;$ iptables -A INPUT -p tcp -m state --state NEW  -m tcp --dport 873 -j ACCEPT
$ iptables -L  查看一下防火墙是不是打开了 873端口
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4 id=&quot;客户端的配置&quot;&gt;客户端的配置&lt;/h4&gt;

&lt;p&gt;客户端的配置很简单，仅需要增加一个密码文件并把权限改为600&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[root@NFS tmp]$ echo &amp;quot;oldboy&amp;quot; &amp;gt;/etc/rsync.password
[root@NFS tmp]$ chmod 600 /etc/rsync.password 
[root@NFS tmp]$ ll /etc/rsync.password 
-rw-------. 1 root root 7 Nov 12 02:03 /etc/rsync.password
[root@NFS tmp]$ cat /etc/rsync.password 
oldboy
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4 id=&quot;备份数据以及自动备份&quot;&gt;备份数据以及自动备份&lt;/h4&gt;

&lt;p&gt;向服务器推送数据：&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;rsync -auvrtzopgP --progress  /backup/ rsync_backup@172.16.1.41::backup --password-file=/etc/rsync.password
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;或者&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;rsync -auvrtzopgP --progress  /backup/ rsync://rsync_backup@172.16.1.41/backup --password-file=/etc/rsync.password
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;从服务器拉回数据&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;rsync -avz   rsync_backup@172.16.1.41::backup /backup/ --password-file=/etc/rsync.password
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;或者&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;rsync -avz   rsync://rsync_backup@172.16.1.41/backup  /backup/ --password-file=/etc/rsync.password
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;小结&quot;&gt;小结&lt;/h3&gt;

&lt;p&gt;配置步骤回顾&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;查看rsync 安装包&amp;gt;&amp;gt;  添加rsync用户 &amp;gt;&amp;gt;  生成配置文件 &amp;gt;&amp;gt;   配置账户，密码文件 &amp;gt;&amp;gt;  密码文件配置权限 600  &amp;gt;&amp;gt;  创建共享的目录并授权rsync &amp;gt;&amp;gt;启动rsync  &lt;code&gt;rsync --daemon&lt;/code&gt; &amp;gt;&amp;gt; 开机启动
排错小结：查看推送或者拉取报错信息， 查看日志 &lt;code&gt;tail /var/log/rsyncd.log&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;重启rsync就必须杀掉进程&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[root@backup backup]$ kill `cat /var/run/rsyncd.pid`
[root@backup backup]$ lsof -i :873
[root@backup backup]$ pkill rsync
[root@backup backup]$ killall rsync
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;rsync 优点
1. 增量备份， 支持socket 集中备份，（支持推拉，都是以客户端参照物）
2. 远程shell 通道模式还可以加密(ssh) 传输 。 socket 需要加密传输，可以利用vpn 服务或ipsec服务&lt;/p&gt;

&lt;p&gt;rsync 缺点
1.  大量小文件时候同步的时候，比对时间长，有的时候，rsync进程可能会停止
2.  同步大文件，10G 这样的大文件有时也会问题，中断。 未完整同步前，是隐藏文件&lt;/p&gt;

&lt;p&gt;实战作业：
5.1.4.2 备份全网服务器数据生产架构方案案例模型
企业案例：rsync上机实战考试题： 
某公司里有一台Web服务器，里面的数据很重要，但是如果硬盘坏了，数据就会丢失，现在领导要求你把数据在其他机器上做一个周期性定时备份。要求如下：
每天晚上00点整在Web服务器A上打包备份网站程序目录并通过rsync命令推送到服务器B上备份保留（备份思路可以是先在本地按日期打包，然后再推到备份服务器上）。
具体要求如下：
1)Web服务器A和备份服务器B的备份目录必须都为/backup。
2)Web服务器站点目录假定为(/var/www/html)。
3)Web服务器本地仅保留7天内的备份。
4)备份服务器上检查备份结果是否正常，并将每天的备份结果发给管理员信箱（选做）。
5)备份服务器上每周六的数据都保留，其他备份仅保留180天备份（选做）。&lt;/p&gt;

&lt;p&gt;拔锚必备思想：
部署流程步骤熟练
rsync原理理解&lt;/p&gt;

&lt;h2 id=&quot;crontab-rsync-定时推送&quot;&gt;crontab + rsync 定时推送&lt;/h2&gt;

&lt;p&gt;定时任务一般都新建一个目录专门用来存放定时任务的sh.我一般呢会存放在&lt;strong&gt;/server/scripts/&lt;/strong&gt;目录下面。 新建一个sh 命名为rsync.dailyBackup.sh. 增加好下内容&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;$ cat rsync.dailyBackup.sh
#! /bin/sh
# backup /backup  to 172.16.1.41:/backup
path=/backup
hostn=$(hostname)
dir=${hostn}-172.16.1.31
ldate=$(date +%F)
mkdir  ${path}/${dir} &amp;amp;&amp;amp;\
/bin/cp /etc/rc.local ${path}/${dir}/rc.local_${ldate} &amp;amp;&amp;amp;\
rsync -az ${path}/ rsync_backup@172.16.1.41::backup/ --password-file=/etc/rsync.password
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;首先测试是否成功执行任务，并推送到rsync服务器。然后便写入crontab &lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;$ crontab -l
#######time sync by lzy at 2015-11-02
*/5 * * * * /usr/sbin/ntpdate time.nist.gov &amp;gt;/dev/null 2&amp;gt;&amp;amp;1

####rsync by lzy at 2015-11-07
00 01 * * * /bin/sh /server/scripts/rsync.sh &amp;gt;/dev/null 2&amp;gt;&amp;amp;1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;实时同步&quot;&gt;实时同步&lt;/h2&gt;

&lt;p&gt;inotify+rsync 
inotify 是一种强大的细粒度的，异步的文件系统事件监控机制， linux内核从2.6.13起，加入了inotify支持。其本身没有推送的功能，只 有监控文件系统的任务. 我们可以用inotify + rsync 做到实时复制，但是
sersync 国人周洋编辑的
inotify + rsync 实时复制  osersync
每秒只能同步200张100K的图片  可以用drbd （备节点不可用）  双协&lt;/p&gt;

&lt;p&gt;查看系统是否支持inotify，如果没有下列文件便表示不支持&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;$ ll /proc/sys/fs/inotify/
total 0
-rw-r--r-- 1 root root 0 Nov  9 17:39 max_queued_events
-rw-r--r-- 1 root root 0 Nov  9 17:39 max_user_instances
-rw-r--r-- 1 root root 0 Nov  9 17:39 max_user_watches
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;max_queued_events,表示调用inotify_init时分配给inotify instance中可排队的event的数目的最大值，超出这值的事件被丢弃，触发IN_Q_OVERFLOW事件&lt;/li&gt;
&lt;li&gt;max_user_instances 每一个user ID可创建的inotify instatnces的数量上限&lt;/li&gt;
&lt;li&gt;max_user_watches表示每个inotify instatnces可监控的最大目录数量。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;安装inotify-tools
方法一&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;$ rpm -ivh /apps/crm/soft_src/inotify-tools-3.14-1.el6.x86_64.rpm 
warning: /apps/crm/soft_src/inotify-tools-3.14-1.el6.x86_64.rpm: Header V3 DSA/SHA1 Signature, key ID 4026433f: NOKEY
Preparing...                ########################################### [100%]
   1:inotify-tools          ########################################### [100%]
$ rpm -qa|grep inotify
inotify-tools-3.14-1.el5.x86_64
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;方法二&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;wget http://github.com/downloads/rvoicilas/inotify-tools/inotify-tools-3.14.tar.gz
tar zxvf inotify-tools-3.14.tar.gz
cd inotify-tools-3.14
./configure --prefix=/usr/local/inotify
make
make install
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;inotifywait-介绍&quot;&gt;inotifywait 介绍&lt;/h3&gt;

&lt;p&gt;如果文件或者目录变更，那么就会调用inotify命令。是一个非常高效的工具。
其语法格式是&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;inotifywait [-hcmrq] [-e &amp;lt;event&amp;gt; ] [-t &amp;lt;seconds&amp;gt; ] [--format &amp;lt;fmt&amp;gt; ] [--timefmt &amp;lt;fmt&amp;gt; ] &amp;lt;file&amp;gt; [ ... ]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;参数：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;-m  监听&lt;/li&gt;
&lt;li&gt; -r, --recursive 递归监控&lt;/li&gt;
&lt;li&gt;  -q, --quiet，不输出信息&lt;/li&gt;
&lt;li&gt; --exclude &lt;pattern\&gt;&lt;/li&gt;
&lt;li&gt; -e &lt;event\&gt;, --event &lt;event\&gt;

&lt;ul&gt;
&lt;li&gt;delete ,create,close_write,modify &lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;--timefmt &lt;fmt&gt; 设置一个时间样式&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;inotifywait -mrq --timefmt &amp;#39;%d/%m/%y %H:%M&amp;#39; --format &amp;#39;%T %w %f&amp;#39; -e create /backup  
inotifywait -mrq --timefmt &amp;#39;%d/%m/%y %H:%M&amp;#39; --format &amp;#39;%T %w %f&amp;#39; -e create,delete,close_write /backup
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;执行第二个命令后的结果格式结果是&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;09/11/15 17:47 /backup/ a
09/11/15 17:47 /backup/ a
09/11/15 17:47 /backup/ a.txt
09/11/15 17:47 /backup/ a.txt
09/11/15 17:47 /backup/ .test.txt.swp
09/11/15 17:47 /backup/ .test.txt.swx
09/11/15 17:47 /backup/ .test.txt.swx
09/11/15 17:47 /backup/ .test.txt.swx
09/11/15 17:47 /backup/ .test.txt.swp
09/11/15 17:47 /backup/ .test.txt.swp
09/11/15 17:47 /backup/ .test.txt.swp
09/11/15 17:48 /backup/ test.txt
09/11/15 17:48 /backup/ test.txt
09/11/15 17:48 /backup/ .test.txt.swp
09/11/15 17:48 /backup/ .test.txt.swp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;刚才注意到 创建一个文件产生的临时文件也都会被记录下来。而且还有重复。为了同步时减少带宽与CPU消耗，就需要使用排除，来排除指定的文件。排除一般有两种方法：1，使用rsync排除; 2,使用inotify排除，同时加入rsync排除,我们一般使用第二种
inotifywati排队监控目录有 --exclude &lt;pattern\&gt; --formfile &lt;file\&gt; 前面可以用正则，后者只能是具体的目录或文件&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;vi inotify_exclude.lst
/tmp/src/pdf
@/tmp/src/2014
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;--formfile 的file只能使用绝对路径，@表示排除。
用正则排除 &lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;--exclude &amp;#39;(.*/*\.log|.*/*\.swp)$|^/tmp/src/mail/(2014|201.*/cache.*)&amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;正则很明子了吧。 排除所有目录下以&lt;strong&gt;.log&lt;/strong&gt;, &lt;strong&gt;.swp&lt;/strong&gt; 结尾的文件，和所有在/tmp/src/mail下面2014这个目录和201*目录下的cache开头的文件或目录
在rsync里排除，这里指定file排除时用相对路径。&lt;/p&gt;

&lt;p&gt;写一个角本&lt;strong&gt;inotifywait.sh&lt;/strong&gt;放到backup目录下面,执行便可以实时同步，以下是几个版本
粗糙版，每次都会让rsync比对所有文件然后再同步&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;#!/bin/bash
/usr/bin/inotifywait -mrq  --format &amp;#39;%w%f&amp;#39; -e create,close_write,delete /backup \
|while read file
do
  cd /backup &amp;amp;&amp;amp;
  rsync -az ./ --delete rsync_backup@172.16.1.41::backup \
  --password-file=/etc/rsync.password
done
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;精准版&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;fullPath=&amp;quot;/usr/bin/inotifywait&amp;quot;

$fullPath -mrq --format &amp;#39;%w%f&amp;#39; -e create,close_write,delete /backup |\
while read line
do
  [ ! -e  &amp;quot;$line&amp;quot; ]  &amp;amp;&amp;amp;\
  rsync -az --delete ./ rsync_backup@172.16.1.41::backup --password-file=/etc/rsync.password &amp;amp;&amp;amp; continue
  rsync -az --delete $line rsync_backup@172.16.1.41::backup --password-file=/etc/rsync.password
done
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上面的是不是很简单，那么再来一个更全面的客户端配置文件&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;cp&quot;&gt;#rsync auto sync script with inotify&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#2015-11-09 sandow&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#variables&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;current_date&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;date&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Y&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;H&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;M&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;source_path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;backup&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;log_file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rsync_client&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#rsync&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;rsync_server&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;172.16.1.41&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;rsync_user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rsync_backup&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;rsync_pwd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;etc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;password&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;rsync_module&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;backup&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;INOTIFY_EXCLUDE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(.&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;*/&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;*/&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;swp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|^/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tmp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mail&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2014&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;20.&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;*/&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;che&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;#39;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;RSYNC_EXCLUDE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;etc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rsyncd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rsync_exclude&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;#39;&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#rsync client pwd check&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rsync_pwd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;then&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;rsync client passwod file ${rsync_pwd} does not exist!&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;exit&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;fi&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#inotify_function&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;inotify_fun&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(){&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;usr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bin&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;inotifywait&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mrq&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timefmt&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Y&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-%&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;H&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;M&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;#39;&lt;/span&gt; \
          &lt;span class=&quot;o&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exclude&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;INOTIFY_EXCLUDE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;modify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;move&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attrib&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;source_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; \
          &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;read&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
          &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;usr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bin&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rsync&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;auvrtzopgP&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exclude&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RSYNC_EXCLUDE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;progress&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bwlimit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rsync_pwd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;source_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rsync_user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rsync_server&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rsync_module&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; 
      &lt;span class=&quot;n&quot;&gt;done&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#inotify log&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;inotify_fun&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;log_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;来点链接，深入研究的话可以上去查看
&lt;a href=&quot;https://rsync.samba.org/how-rsync-works.html&quot;&gt;How Rsync Works A Practical Overview&lt;/a&gt;
&lt;a href=&quot;https://www.ibm.com/developerworks/cn/linux/l-inotify/&quot;&gt;用 inotify 监控 Linux 文件系统事件&lt;/a&gt;
&lt;a href=&quot;http://www.infoq.com/cn/articles/inotify-linux-file-system-event-monitoring&quot;&gt;inotify: 高效、实时的Linux文件系统事件监控框架&lt;/a&gt;
&lt;a href=&quot;http://coolshell.cn/articles/7425.html&quot;&gt;rsync 的核心算法&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;sersync&quot;&gt;sersync&lt;/h2&gt;

&lt;p&gt;听同事说 sersync 这么个工具可以提高同步的性能，也解决了同步大文件时出现异常的问题，所以就尝试了一下。sersync是国内的一个开发者开源出来的，使用c++编写，采用多线程的方式进行同步，失败后还有重传机制，对临时文件过滤，自带crontab定时同步功能。网上看到有人说性能还不错，但是我觉得：&lt;/p&gt;

&lt;p&gt;国产开源，文档不是很全，在2011年之后就没更新了。采用xml配置文件的方式，可读性比较好，但是有些原生的有些功能没有实现就没法使用了。&lt;/p&gt;

&lt;p&gt;无法实现多目录同步，只能通过多个配置文件启动多个进程，文件排除功能太弱。&lt;/p&gt;

&lt;p&gt;虽然提供插件的功能，但很鸡肋，因为软件本身没有持续更新，也没有看到贡献有其它插件出现（可能是我知识面不够，还用不到里面的refreshCDN plugin）。虽然不懂c++，但大致看了下源码 FileSynchronize，拼接rsync命令大概在273行左右，最后一个函数就是排除选项，简单一点可以将--exclude=改成--eclude-from来灵活控制。有机会再改吧。&lt;/p&gt;

&lt;p&gt;另外，在作者的文章 Sersync服务器同步程序 项目简介与设计框架 评论中，说能解决上面 rsync + inotify中所描述的问题。阅读了下源码，这个应该是没有解决，因为在拼接rsync命令时，后面的目的地址始终是针对module的，只要执行rsync命令，就会对整个目录进行遍历，发送要比对的文件列表，然后再发送变化的文件。sersync只是减少了监听的事件，减少了rsync的次数——这已经是很大的改进，但每次rsync没办法改变。（如有其它看法可与我讨论）&lt;/p&gt;

&lt;p&gt;其实我们也不能要求每一个软件功能都十分健全，关键是看能否满足我们当下的特定的需求。所谓好的架构不是设计出来的，而是进化来的。目前使用sersync2没什么问题，而且看了它的设计思路应该是比较科学的，特别是过滤队列的设计。双向同步看起来也是可以实现。&lt;/p&gt;

&lt;h2 id=&quot;rsync常见错误与问题&quot;&gt;rsync常见错误与问题&lt;/h2&gt;

&lt;p&gt;Q：如何通过ssh进行rsync，而且无须输入密码？&lt;br&gt;
- 可以通过以下几个步骤        &lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;通过ssh-keygen在server A上建立SSH keys，不要指定密码，你会在~/.ssh下看到identity和identity.pub文件 &lt;/li&gt;
&lt;li&gt;在server B上的home目录建立子目录.ssh&lt;/li&gt;
&lt;li&gt;将A的identity.pub拷贝到server B上&lt;/li&gt;
&lt;li&gt;将identity.pub加到~[user b]/.ssh/authorized_keys&lt;/li&gt;
&lt;li&gt;于是server A上的A用户，可通过下面命令以用户B ssh到server B上了。e.g. ssh -l userB serverB。这样就使server A上的用户A就可以ssh以用户B的身份无需密码登陆到server B上了。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Q：如何通过在不危害安全的情况下通过防火墙使用rsync?&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;解答如下： 
这通常有两种情况，一种是服务器在防火墙内，一种是服务器在防火墙外。无论哪种情况，通常还是使用ssh，这时最好新建一个备份用户，并且配置sshd 仅允许这个用户通过RSA认证方式进入。如果服务器在防火墙内，则最好限定客户端的IP地址，拒绝其它所有连接。如果客户机在防火墙内，则可以简单允许防 火墙打开TCP端口22的ssh外发连接就ok了。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Q：我能将更改过或者删除的文件也备份上来吗？&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;当然可 以。你可以使用如：rsync -other -options -backupdir = ./backup-2000-2-13  ...这样的命令来实现。这样如果源文件:/path/to/some/file.c改变了，那么旧的文件就会被移到./backup- 2000-2-13/path/to/some/file.c，这里这个目录需要自己手工建立起来&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Q：我需要在防火墙上开放哪些端口以适应rsync？&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;视情况而定。rsync可以直接通过873端口的tcp连接传文件，也可以通过22端口的ssh来进行文件传递，但你也可以通过下列命令改变它的端口：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;$ iptables -A INPUT -p tcp -m state --state NEW  -m tcp --dport 873 -j ACCEPT  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code&gt;rsync --port 8730 otherhost::&lt;/code&gt;或者&lt;code&gt;rsync -e &amp;#39;ssh -p 2002&amp;#39; otherhost:&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Q：我如何通过rsync只复制目录结构，忽略掉文件呢？   &lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;rsync -av --include &amp;#39;*/&amp;#39; --exclude &amp;#39;*&amp;#39; source-dir dest-dir&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Q：为什么我总会出现&amp;quot;Read-only file system&amp;quot;的错误呢？&lt;br&gt;
 - 看看是否忘了设&amp;quot;read only = no&amp;quot;了&lt;/p&gt;

&lt;p&gt;Q：为什么我会出现&amp;#39;@ERROR: invalid gid&amp;#39;的错误呢？&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;rsync使用时默认是用uid=nobody;gid=nobody来运行的，如果你的系统不存在nobody组的话，就会出现这样的错误，可以试试gid = ogroup或者其它&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Q：绑定端口873失败是怎么回事？&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;如果你不是以root权限运行这一守护进程的话，因为1024端口以下是特权端口，会出现这样的错误。你可以用--port参数来改变。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Q：为什么我认证失败？ 
 - 从你的命令行看来：你用的是&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;bash$ rsync -a 144.16.251.213::test test
Password:
@ERROR: auth failed on module test 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;应该是没有以你的用户名登陆导致的问题，试试rsync -a &lt;a href=&quot;mailto:max@144.16.251.213&quot;&gt;max@144.16.251.213&lt;/a&gt;::test test&lt;/p&gt;

&lt;p&gt;Q: 出现以下这个讯息, 是怎么一回事?    &lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;@ERROR: auth failed on module xxxxx
rsync: connection unexpectedly closed (90 bytes read so far)
rsync error: error in rsync protocol data stream (code 12) at io.c(150)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;这是因为密码设错了, 无法登入成功, 请再检查一下 rsyncd.secrets 中的密码设定, 二端是否一致?&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Q: 出现以下这个讯息, 是怎么一回事?    &lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;password file must not be other-accessible 
continuing without password file 
Password:
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;这表示 rsyncd.secrets 的档案权限属性不对, 应设为 600。请下 chmod 600 rsyncd.secrets&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Q: 出现以下这个讯息, 是怎么一回事?&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;@ERROR: chroot failed
rsync: connection unexpectedly closed (75 bytes read so far)
rsync error: error in rsync protocol data stream (code 12) at io.c(150)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;这通常是您的 rsyncd.conf 中的 path 路径所设的那个目录并不存在所致.请先用 mkdir开设好备份目录.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;高并发数据实时同步方案小结
1。inotify+rsync 文件级别
2。drbd 文件系统级别
3。 第三方软件的同步功能， mysql, oracle, mongodb
4.。 程序双写
5。业务逻辑解决。（读写分离，备读不到，读主）&lt;/p&gt;
</description>
        <pubDate>Mon, 09 Nov 2015 00:00:00 +0800</pubDate>
        <link>//linux/inotify-rsync</link>
        <guid isPermaLink="true">//linux/inotify-rsync</guid>
        
        <category>linux</category>
        
        
        <category>linux</category>
        
      </item>
    
      <item>
        <title>python基础</title>
        <description>&lt;ol&gt;
&lt;li&gt;在一个列表中去除出现次数为1的数字。给定例子有[1,2,3,1,3], [3,4,5,7,4,7].&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;方法一&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;checkio&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;data1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;element&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;element&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;data1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;element&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data1&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;方法二&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;checkio&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;方法三&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;    &lt;span class=&quot;n&quot;&gt;checkio&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ol&gt;
&lt;li&gt;找出列表中位数, （如果长度为奇数那么就是中间那个数字，如果是偶数便是中间两个的平均数）&lt;/li&gt;
&lt;/ol&gt;
</description>
        <pubDate>Tue, 20 Oct 2015 02:06:05 +0800</pubDate>
        <link>//python/learning-python-checkio</link>
        <guid isPermaLink="true">//python/learning-python-checkio</guid>
        
        <category>checkio</category>
        
        
        <category>python</category>
        
      </item>
    
      <item>
        <title>优化系统</title>
        <description>&lt;p&gt;本文对系统做出视频优化， 针对刚入门linux的人来说了解其如何配置是必要的，之后在需要的时候也可适当配置。&lt;/p&gt;

&lt;h2 id=&quot;selinux&quot;&gt;SELinux&lt;/h2&gt;

&lt;p&gt;SELinux（Security-enhanced linux）是美国国家安全局（nsa）对于强制访问控制的实现，是linux历史上最杰出的新安全子系统。 但因为控制太严格，生产环境不用它，使用其他的安全手段。现在有关配置文件放在 /etc/selinux/config 下&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;$ cat /etc/selinux/config 

# This file controls the state of SELinux on the system.
# SELINUX= can take one of these three values:
#     enforcing - SELinux security policy is enforced.
#     permissive - SELinux prints warnings instead of enforcing.
#     disabled - No SELinux policy is loaded.
SELINUX=disabled
# SELINUXTYPE= can take one of these two values:
#     targeted - Targeted processes are protected,
#     mls - Multi Level Security protection.
SELINUXTYPE=targeted 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;由此可以看到SELinux 用三个值， enforcing， permissive， disabled。
* enforcing 就是如果你违反了策略，你就无法继续操作下去。
* Permissive 就是selinux 有效， 但即使你违反了策略的也会让你继续操作，但是把你违反的内容记录下来。
* disabled 就是关闭selinux &lt;/p&gt;

&lt;p&gt;SELINUXTYPE 主要有两大类，
* targeted 是红帽
*&lt;/p&gt;
</description>
        <pubDate>Tue, 20 Oct 2015 02:06:05 +0800</pubDate>
        <link>//linux/optimize-system</link>
        <guid isPermaLink="true">//linux/optimize-system</guid>
        
        <category>SELinux</category>
        
        <category>iptables</category>
        
        <category>descriptor</category>
        
        
        <category>linux</category>
        
      </item>
    
      <item>
        <title>在ubuntu下面安装centos</title>
        <description>&lt;p&gt;之前在windows环境下在VMWARE里安装过一次CentOs,因自己在windows下搭建编程环境过于麻烦，昨日脑袋一发热便把window直接换成了Ubuntu，且在Ubuntu, 并安装VM用来搭建服务器测试环境。  &lt;/p&gt;

&lt;h2 id=&quot;安装vmware&quot;&gt;安装VMWARE&lt;/h2&gt;

&lt;p&gt;有关在ubuntu下安装vmware的教程可以参见&lt;a href=&quot;http://www.linuxtechi.com/install-vmware-workstation-11-on-ubuntu-linux/&quot;&gt;How To Install VMware Workstation 11 On Ubuntu Linux&lt;/a&gt;下面主要列出关键步骤  &lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;从官网下载vmware &lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;$ wget https://download3.vmware.com/software/wkst/file/VMware-Workstation-Full-11.0.0-2305329.x86_64.bundle
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;在脚本包上设置执行命令&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;$ chmod a+x VMware-Workstation-Full-11.0.0-2305329.x86_64.bundle
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;执行脚本开始安装&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;$ sudo ./VMware-Workstation-Full-11.0.0-2305329.x86_64.bundle
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;然后便是图形化界面的按照自己的意愿下一步下一步就OK，要注意记住HTTP port是443. 但是安装之后打开程序创建虚拟网卡时出错，一个解决办法是把vmnet.tar替换掉，链接之后附上。然后顺利进入vmware，接下来便可以安装centos了。&lt;/p&gt;

&lt;h2 id=&quot;安装centos&quot;&gt;安装centos&lt;/h2&gt;

&lt;p&gt;新建虚拟机，载入ISO，开机。进入安装界面后前几项都按照默认既可。在which type of installation would you like里选择create  custom layout. 对磁盘进行分区
首先可以给/boot以及swap分区&lt;/p&gt;

&lt;table&gt;&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align: left&quot;&gt;分区&lt;/th&gt;
&lt;th style=&quot;text-align: left&quot;&gt;大小&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;/boot 存放引导程序&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;100-200M&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;swap 虚拟内存&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;物理内存&lt;8G，SWAP就实际内存\*1.5,物理内存&gt;8G，SWAP就 8G&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;后面按不同的场景来划分利剩余的空间&lt;/p&gt;

&lt;table&gt;&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align: left&quot;&gt;生产场景&lt;/th&gt;
&lt;th style=&quot;text-align: left&quot;&gt;对剩余空间的分配方案&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;集群的节点分区方法&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;把剩余的数据都给根（/）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;重要数据的业务：存储，数据库&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;根（/）给50-200G，剩余给/data 存放数据用&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;门户网站，大型企业&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;/  根 给50-200G，剩余的预留&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;自己因为是测试环境，所以分区便把其它都给了根。校正，swap本来要给他1024的，结果只给了200  &lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/format-dives.jpg&quot; alt=&quot;format-divers&quot;&gt;  &lt;/p&gt;

&lt;p&gt;格式代后便进入选包环节，选择minimal-customize now。 我们以最小化为仅选择四个包见下图。  &lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/format-divers1.jpg&quot; alt=&quot;format-divers&quot;&gt;&lt;br&gt;
&lt;img src=&quot;/images/selection-package1.jpg&quot; alt=&quot;selection-package1&quot;&gt;&lt;br&gt;
&lt;img src=&quot;/images/selection-package2.jpg&quot; alt=&quot;selection-package2&quot;&gt;  &lt;/p&gt;

&lt;h2 id=&quot;配置网络&quot;&gt;配置网络&lt;/h2&gt;

&lt;p&gt;在centos里配置网络,这里需要说明的是，&lt;strong&gt;在centos里配置的网段必须与VM里的网段一样&lt;/strong&gt;。可以在edit &amp;gt; virtual network edit里面查看并配置因为我选择的是nat网络，所以这里只需要配置vmnet8既可配置见下图之后进入.  &lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/ubuntu-vmnet8-setting.jpg&quot; alt=&quot;vmware-vmnet8-setting&quot;&gt;  &lt;/p&gt;

&lt;p&gt;然后在ubuntu,系统设置-网络里对vmnet8做进一步配置见下图。  &lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/vmware-vmnet8-setting.jpg&quot; alt=&quot;ubuntu-vmnet8-setting&quot;&gt;&lt;/p&gt;

&lt;p&gt;进入centos里输入 &lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;vi /etc/sysconfig/network-scripts/ifcfg-eth0 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;对centos网卡进行配置  &lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/centos-networking-setting.png&quot; alt=&quot;centos-networking-setting&quot;&gt;&lt;/p&gt;

&lt;p&gt;之后便可以顺利上网了。&lt;/p&gt;
</description>
        <pubDate>Tue, 20 Oct 2015 02:06:05 +0800</pubDate>
        <link>//ubuntu/install-centos-onubuntu</link>
        <guid isPermaLink="true">//ubuntu/install-centos-onubuntu</guid>
        
        <category>ubuntu</category>
        
        
        <category>ubuntu</category>
        
      </item>
    
      <item>
        <title>在ubuntu下面安装PAC Manager</title>
        <description>&lt;h2 id=&quot;安装pac-manager&quot;&gt;安装PAC Manager&lt;/h2&gt;

&lt;p&gt;近日开始放弃WIN10转而用Ubuntu，原因很简单，因为自己在搭建环境的时候在windows下相当不顺手，而且总出错，每个包都需要自己一个个下一个个安装，累了，真的累了。果断换成Ubuntu,一行命令便可搞定所有问题。 上一次说到在Ubuntu里面安装了VMware但是如果用Terminal输入命令&lt;code&gt;ssh -p22 sandow@10.0.0.19&lt;/code&gt; 这样连接虽然是完全OK的，但每天都这样输也是个麻烦事，如果用alias做了别名后又不能连别的IP，而且还不能批量管理多个虚拟机，百度搜到有一个Ubuntu下的CRT，但是官网已经不支持下载更何况要怎么破解呢。后来发现了一个替代CRT的程序，那就是PAC Manager 下面便记录下是如何安装并且使用之的。  &lt;/p&gt;

&lt;p&gt;首先去&lt;a href=&quot;http://sourceforge.net/projects/pacmanager/&quot;&gt;PAC Manager官网&lt;/a&gt;下载安装&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;sudo dpkg -i pac-*.deb
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;发现提示错误，提示信息显示依赖关系未被配置，&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;(正在读取数据库 ... 系统当前共安装有 199158 个文件和目录。)
正准备解包 pac-4.5.5.5-all.deb  ...
正在将 pac (4.5.5.5) 解包到 (4.5.3.2) 上 ...
dpkg: 依赖关系问题使得 pac 的配置工作不能继续：
 pac 依赖于 libgtk2-unique-perl；然而：
  未安装软件包 libgtk2-unique-perl。

dpkg: 处理软件包 pac (--install)时出错：
 依赖关系问题 - 仍未被配置
正在处理用于 man-db (2.7.0.2-5) 的触发器 ...
正在处理用于 gnome-menus (3.10.1-0ubuntu5) 的触发器 ...
正在处理用于 desktop-file-utils (0.22-1ubuntu3) 的触发器 ...
正在处理用于 bamfdaemon (0.5.1+15.04.20150202-0ubuntu1) 的触发器 ...
Rebuilding /usr/share/applications/bamf-2.index...
正在处理用于 mime-support (3.58ubuntu1) 的触发器 ...
在处理时有错误发生：
 pac
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这个怎么整呢，可能是还有很多支持包未安装，&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;sudo apt-get -f install
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;将会看到下面信息：&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;将会安装下列额外的软件包：
  libgtk2-unique-perl libunique-1.0-0
下列【新】软件包将被安装：
  libgtk2-unique-perl libunique-1.0-0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这时便可以修复依赖关系。但如果出现错误完法可能需要清理下包了&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;sudo apt-get -f clean
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;然后再执行上面的命令，完美解决问题，等安装完成后便输入&lt;code&gt;pac&lt;/code&gt;便可以进入PAC Manager界面了。之后若PAC用的顺手再来谈PAC的的心得。&lt;/p&gt;

&lt;h2 id=&quot;问题&quot;&gt;问题&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;字体挤在一起
这里需要把字体调成ubuntu mono, options &amp;gt;&amp;gt; terminal optins 下调。
PAC用着十分友好，可以分屏，可以同时在不同窗口输命令，还是不错的。在左下角的PCC&lt;/li&gt;
&lt;/ol&gt;
</description>
        <pubDate>Mon, 19 Oct 2015 20:06:05 +0800</pubDate>
        <link>//ubuntu/install-crt-inubuntu</link>
        <guid isPermaLink="true">//ubuntu/install-crt-inubuntu</guid>
        
        <category>ubuntu</category>
        
        
        <category>ubuntu</category>
        
      </item>
    
      <item>
        <title>文件属性详细介绍</title>
        <description>&lt;p&gt;在linux 系统下一切皆文件,而文件的属性众多,所以本文便对文件属性做简单介绍,我们知道可以用 &lt;code&gt;ls -lhi&lt;/code&gt;  查看文件的信息,下面是所有内容.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;$ ll -ih
total 52K
7079756 drwxrwxr-x 11 sandow sandow 4096 10月 18 02:44 magdre.github.io
7079693 drwxrwxr-x  3 sandow sandow 4096 10月 23 21:42 sorcesPicture
7341765 drwxrwxr-x  3 sandow sandow 4096 10月 23 21:51 video
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;第一列都有不同的含义, 第一列为索引节点, 第二列第一个字符为文件类型,后面三为所属主权限,再后面三为所属组权限,然后是其它用户权限. 第三列为硬链接数, 第四列第五列为属主与所归属组. 然后是文件大小, 文件修改时间, 文件名.&lt;/p&gt;

&lt;h2 id=&quot;索引节点-inode-index-node&quot;&gt;索引节点(inode, index node)&lt;/h2&gt;

&lt;p&gt;我们知道硬盘的最小存储单位叫做&amp;quot;扇区&amp;quot;（Sector）。每个扇区储存512字节, 操作系统读取硬盘的时候，不会一个个扇区地读取，这样效率太低，而是一次性连续读取多个扇区，即一次性读取一个&amp;quot;块&amp;quot;（block）。这种由多个扇区组成的&amp;quot;块&amp;quot;，是文件存取的最小单位。&amp;quot;块&amp;quot;的大小，最常见的是4KB，即连续八个 sector组成一个 block。文件数据都储存在&amp;quot;块&amp;quot;中，那么很显然，我们还必须找到一个地方储存文件的元信息，比如文件的创建者、文件的创建日期、文件的大小等等。这种储存文件元信息的区域就叫做inode，中文译名为&amp;quot;索引节点&amp;quot;。&lt;/p&gt;

&lt;p&gt;inode在centos6中存储空间为256字节/每个. 存放的内容是文件属性信息有: user ID, Group ID, 文件读写执行权限,文件的时间戳, 文件数据block的位置(指向文件实体的指针). (ls -lhi 除文件名外所有内容) . &lt;/p&gt;

&lt;p&gt;上面信息中的第一列便是索引节点, 下面是查看block 与 inode 的大小&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;$ dumpe2fs /dev/sda1 |egrep -i &amp;#39;block size|inode size&amp;#39;
dumpe2fs 1.41.12 (17-May-2010)
Block size:              1024
Inode size:           128

$ df -ih            #inodes
Filesystem     Inodes IUsed IFree IUse% Mounted on
/dev/sda3        434K   66K  369K   16% /
tmpfs            123K     1  123K    1% /dev/shm
/dev/sda1         50K    39   50K    1% /boot

$ df
Filesystem     1K-blocks    Used Available Use% Mounted on
/dev/sda3        6866948 1794980   4716488  28% /
tmpfs             502384       0    502384   0% /dev/shm
/dev/sda1         194241   40464    143537  22% /boot
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;可以用stat来查看索引节点的内容&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;$ stat a.txt
File: `a.txt&amp;#39;
Size: 36              Blocks: 8          IO Block: 4096   regular file
Device: 803h/2051d      Inode: 161530      Links: 1
Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)
Access: 2015-10-05 18:00:33.344105948 +0800
Modify: 2015-10-05 18:00:29.382086843 +0800
Change: 2015-10-05 18:00:29.382086843 +0800
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;总结:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;磁盘格式他ext4文件系统后会生成一定数量的inode和block,&lt;/li&gt;
&lt;li&gt;inode是索引节点,主要用来存放文件的属性,以及作为文件的索引(指向文件的实体)&lt;/li&gt;
&lt;li&gt;ext3/ext4文件系统的block存放的是文件的实际内容&lt;/li&gt;
&lt;li&gt;indoe是一块存储空间,centos6非启动分区inode是默认大小256字节, centos5是128&lt;/li&gt;
&lt;li&gt;inode 是一串数字,不同的文件对应的inode(一串数字),在文件系统里是唯一的&lt;/li&gt;
&lt;li&gt;inode相同的文件,互为硬链接文件&lt;/li&gt;
&lt;li&gt;一个文件创建后至少要占用一个inode 和一个block&lt;/li&gt;
&lt;li&gt;block的大小一般有1k,2k,4k几种其中引导分区等为1k,其他的普通分区为4k(c6)&lt;/li&gt;
&lt;li&gt;如果一个文件很大,可能占多个block,如果文件很小,至少占一个block并且剩余空间浪费了.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;一个文件可能占用多个block,每读一个block就会消耗一次磁盘i/o,如果要提升磁盘IO性能,那么要尽可能一次性读取数据尽量的多.
一个block只能存放一个文件的内容,无论内容有多小,如果block4K,那存放1k的文件,剩余3K就浪费了
ex3/ex4一般都默认为4k&lt;/p&gt;

&lt;p&gt;一个100M(100000K)的磁盘分区不,分别写放1K的文件或者写入1M的文件,分别可以写多少个?&lt;br&gt;
 答: 1) Inode是存放文件属性信息的，默认大小128byte(c58)，256byte(c64)。 2) Block 是存放文件实际内容的，默认大小1K（boot）或4K（非系统分区默认给4K）。3)  一个文件至少要占用一个inode及一个block。4)  默认分区常规情况下，inode数量是足够的。而block数量消耗的会更快。&lt;/p&gt;

&lt;p&gt;由于inode号码与文件名分离，这种机制导致了一些Unix/Linux系统特有的现象。  &lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;有时，文件名包含特殊字符，无法正常删除。这时，直接删除inode节点，就能起到删除文件的作用。&lt;/li&gt;
&lt;li&gt;移动文件或重命名文件，只是改变文件名，不影响inode号码。&lt;/li&gt;
&lt;li&gt;打开一个文件以后，系统就以inode号码来识别这个文件，不再考虑文件名。因此，通常来说，系统无法从inode号码得知文件名。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;在一台配置较低的Linux服务器（内存、硬盘比较小）的/data分区内创建文件时，系统提示磁盘空间不足，用df -h命令查看了一下磁盘使用情况，发现/data分区只使用了66%，还有12G的剩余空间，按理说不会出现这种问题。 后来用df -i查看了一下/data分区的索引节点(inode)，发现已经用满(IUsed=100%)，导致系统无法创建新目录和文件。&lt;br&gt;
&lt;em&gt;原因&lt;/em&gt;:　/data/cache目录中存在数量非常多的小字节缓存文件，占用的Block不多，但是占用了大量的inode。&lt;br&gt;
&lt;em&gt;解决方案&lt;/em&gt;：  &lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;删除/data/cache目录中的部分文件，释放出/data分区的一部分inode。&lt;br&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;用软连接将空闲分区/opt中的newcache目录连接到/data/cache，使用/opt分区的inode来缓解/data分区inode不足的问题：  &lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;ln -s /opt/newcache /data/cache 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;hr&gt;

&lt;h2 id=&quot;文件类型&quot;&gt;文件类型&lt;/h2&gt;

&lt;p&gt;在 linux 下面一切此后文件,而常用的文件类型可以有有下面几种&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;b      block (buffered) special 块设备文件, 硬盘,光驱,磁盘等&lt;/li&gt;
&lt;li&gt;c      character (unbuffered) special 字符设备文件, 串口设备&lt;/li&gt;
&lt;li&gt;d      directory  目录&lt;/li&gt;
&lt;li&gt;f      regular file 普通文件(-) 可以为ASCII text 纯文件文件, 也可以是二进制文件(executable),还可以是数据格式的文件(data)&lt;/li&gt;
&lt;li&gt;l      symbolic link 符号链接文件&lt;/li&gt;
&lt;li&gt;s      socket&lt;/li&gt;
&lt;/ol&gt;

&lt;hr&gt;

&lt;h2 id=&quot;文件权限&quot;&gt;文件权限&lt;/h2&gt;

&lt;p&gt;在linux下每一个文件都有非常多的属性与权限，下面只针对文件的权限做简单介绍。上面第二列的从第二个字符起类似&lt;strong&gt;rwxrwxr-x&lt;/strong&gt;便是文件的权限， 其中rwx分别为(read, write, execute)的缩写，代表数字为 4,2,1 改变权限可以用 &lt;code&gt;chmod 644 somefile&lt;/code&gt; 变更。在这里需要注意只有root或者所属主才有变更文件权限的权力 。  &lt;/p&gt;

&lt;p&gt;创建一个文件或者目录的默认权限由umask控制。在不更改的情况下，创建文件默认权限为644,创建目录的默认权限为755. 我们可以用 &lt;code&gt;umask 22&lt;/code&gt;来更改  &lt;/p&gt;

&lt;h3 id=&quot;rwx针对普通文件&quot;&gt;rwx针对普通文件&lt;/h3&gt;

&lt;ol&gt;
&lt;li&gt;r 拥有读取\阅读文件内容的权限;&lt;/li&gt;
&lt;li&gt;w 拥有新增，修改文件内容的权限; 

&lt;ul&gt;
&lt;li&gt;如果没有r vi会提示无法编辑（可以强制编辑），echo 可以重定向或者追加;&lt;/li&gt;
&lt;li&gt;删除文件的权限受父目录的权限控制，和文件本身无关。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;x 可执行，表示拥有执行文件的权限

&lt;ul&gt;
&lt;li&gt;文件本身要能够执行 &lt;/li&gt;
&lt;li&gt;普通用户同时还需要拥有r的权限才可能执行&lt;/li&gt;
&lt;li&gt;root只要有x的权限就能执行&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;rwx针对目录&quot;&gt;rwx针对目录&lt;/h3&gt;

&lt;ol&gt;
&lt;li&gt;r 表示拥有浏览目录下面及子目录的权限即ls dir

&lt;ul&gt;
&lt;li&gt;如果没有x权限，不能进到目录里，&lt;/li&gt;
&lt;li&gt;如果没有x权限，ls列表可以看到所有文件名，但是会提示无权访问目录下文件&lt;/li&gt;
&lt;li&gt;ls -l 所胡的属性会带有问号，会提示无权访问目录下文件&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;w  表示拥有增加删除或者修改目录内文件名的权限 需要有x（可以进入）&lt;/li&gt;
&lt;li&gt;x 表示拥有进入目录的权限，但如果没有r无法列表文件及目录，没有w无法新建和删除，&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;特殊权限位（了解）&quot;&gt;特殊权限位（了解）&lt;/h3&gt;

&lt;p&gt;特殊权限位有三个 &lt;/p&gt;

&lt;p&gt;|名称|符号表示 | 代表数字|
|suid| s  S | 4   |&lt;br&gt;
|sgid |s S  |  2  |
|sticky|t T | 1  |&lt;/p&gt;

&lt;p&gt;注意这里的Ss Tt的区别是当所属主，或者所属组，或者其它用户拥有权限时便为小写st，无执行权限时便为大写ST， 沾滞位只能用ROOT来删除或创建。被创建的目录，任何用户可以在该目录下可以创建文件目录，但不能查看其它用户的内容，（/tmp）  &lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;chmod (4000|2000|1000) /bin/rm  
chmod (u|g|o)+(s|t )
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;suid  权限位，针对所属主权限位，主要对二进制命令附加权限，使得执行该命令时拥有和root一样高的权限。suid的权限仅在程序命令执行过程中有效，执行结束结束。以下仅是一个例子，请忘掉rm这个命令。  &lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;chmod 4755 /bin/rm
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;sgid 是针对用户组权限位的。
对于文件，sgid 仅对二进制的命令程序有效，二进制命令或程序需要有可执行权限，任意用户执行命令， 可以获得该命令程序执行期间所属组的权限。&lt;br&gt;
对于目录sgid 创建一个目录，要求在其 目录下创建的文件或目录的group继承该目录组  &lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;chmod 2755 /home/admins/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;以下命令用来查找拥有特殊属性的文件&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;find / -perm 4755 -type f 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;hr&gt;

&lt;h2 id=&quot;用户与组&quot;&gt;用户与组&lt;/h2&gt;

&lt;p&gt;Linux 多用户多任务&lt;/p&gt;

&lt;p&gt;Linux 系统中用户分角色的,用记的角色是通过UID和GID识别的,特别是UID,UID是唯一标识一个系统用户的账号&lt;/p&gt;

&lt;p&gt;user identify UID
group identify GID&lt;/p&gt;

&lt;p&gt;超级用户,root GID UID 均为0,  &lt;/p&gt;

&lt;p&gt;1-499 虚拟用户
500及以上为普通用户.&lt;/p&gt;

&lt;h2 id=&quot;软硬链接&quot;&gt;软硬链接&lt;/h2&gt;

&lt;h3 id=&quot;hard-ling-硬链接&quot;&gt;hard ling 硬链接&lt;/h3&gt;

&lt;p&gt;硬链接是通过索引节点inode 来进行对文件block进行链接,来访问文件内容，也就是说如果文件内容变更了，通过多个硬链接都可以查看到文件的block，且内容一样，删除其中一个硬链接不是影响到文件的block，只有把该文件的所有硬链接删除，以及文件的block删除后文件才真正的删除。在linux系统中,多个文件名可以指向同一个索引节点是正常且允许的，具有相同的inode的文件互为硬链接&lt;br&gt;
硬链接可以用&lt;code&gt;ln 源文件  硬链接文件&lt;/code&gt; 即可创建硬链接.对于静态文件(没有进程正在调用的文件)来讲,当对硬链接数为 0(i_link) 时文件被删除. 可以用&lt;code&gt;lsof |grep deleted&lt;/code&gt;  查看删除的数据  &lt;/p&gt;

&lt;h3 id=&quot;symbolic-links-软链接&quot;&gt;symbolic links 软链接&lt;/h3&gt;

&lt;p&gt;symbolic links or soft likn  软链接或符号链接. 软链接的文件类型是l, 这个文件中包含有软链接指向另一源文件的位置信息内容.  &lt;/p&gt;

&lt;p&gt;通过读取软链接里的原文件绝对路径的源文件名来访问原文件.删除源文件,软件链接文件依然存在,但无法防问源文件内容, 但在原位置重新创建一个文件,软链接可继续访问此文件.软链接文件拥有不同的Inode，而且在查看文件时，其最后会指向所链接的实际文件路径。&lt;br&gt;
&lt;code&gt;
ln -s  [源文件] [链接文件]
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;注意目录硬链接无法跨越文件系统,但可以创建软链接, 工作中经常用到的是给目录创建软链接.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;$ ll 
total 0
$ ll -aih
total 8.0K
169682 drwxr-xr-x  2 root root 4.0K Oct 16 23:12 .
129285 dr-xr-x---. 3 root root 4.0K Oct 16 23:12 ..
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;以点(.)开头为隐藏文件, &lt;code&gt;ls -a&lt;/code&gt; 可以查看到隐藏文件. 创建一个目录,目录下面默认有两个文件(.)与(..) 点与当前目录互为硬链接. (..)与上一级目录互为硬链接. 且文件名在上一级目录的block里面.&lt;/p&gt;

&lt;h2 id=&quot;时间&quot;&gt;时间&lt;/h2&gt;

&lt;p&gt;文件属性中有三种时间&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;access  访问时间,   对应find -atime&lt;/li&gt;
&lt;li&gt;modify  修改时间 ls 默认显示修改时间, 对应 find -mtime&lt;/li&gt;
&lt;li&gt;change  改变属性权限|对应 find -ctime&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;可以主用--time-style 来修改ls显示的时间样式,可以项有long-iso,  full-iso&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;ls -l --time-style=long-iso 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;通配符&quot;&gt;通配符&lt;/h2&gt;

&lt;p&gt;普通命令都可以用的特殊符号，不同的通配符有不同的意义，现在简单介绍在linux中不同的通配符的不同意义。&lt;/p&gt;

&lt;table&gt;&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align: left&quot;&gt;符号&lt;/th&gt;
&lt;th style=&quot;text-align: left&quot;&gt;意义&lt;/th&gt;
&lt;th style=&quot;text-align: left&quot;&gt;符号&lt;/th&gt;
&lt;th style=&quot;text-align: left&quot;&gt;意义&lt;/th&gt;
&lt;th style=&quot;text-align: left&quot;&gt;符号&lt;/th&gt;
&lt;th style=&quot;text-align: left&quot;&gt;意义&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;*&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;所有&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;?&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;代表一个字符&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;命令分隔符&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;#&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;注释&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;\&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;管道&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;～&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;-&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;上一次目录&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;$&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;调用变量&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;/&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;路径分隔符&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;&amp;gt;  &amp;gt;&amp;gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;重定向，追加重定向&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;&amp;lt;  &amp;lt;&amp;lt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;输入重定向，追加输入重定向&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;{}&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;内容序列&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;&amp;#39;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;无变量转换功能&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;&amp;quot;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;里面变量可以转换&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;`(反引号)&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;把里面内容当做命令执行&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;简单举例&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;n&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;etc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bbc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;blog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;z&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;$a&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;&lt;/span&gt;     &lt;span class=&quot;c&quot;&gt;#输出是1&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;#39;$a&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;#39;&lt;/span&gt;     &lt;span class=&quot;c&quot;&gt;#输出结果是 $a&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;sb&quot;&gt;`date`&lt;/span&gt;       &lt;span class=&quot;c&quot;&gt;#输出结果是当时时间长格式&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
        <pubDate>Sat, 17 Oct 2015 07:06:05 +0800</pubDate>
        <link>//linux/file-attribute</link>
        <guid isPermaLink="true">//linux/file-attribute</guid>
        
        <category>linux</category>
        
        <category>permissions</category>
        
        
        <category>linux</category>
        
      </item>
    
      <item>
        <title>试着在里观看音视频</title>
        <description>&lt;h1 id=&quot;轻松一刻&quot;&gt;轻松一刻&lt;/h1&gt;

&lt;p&gt;Try, very like it&lt;/p&gt;

&lt;audio src=&quot;/images/Colbie_Caillat_Try.mp3&quot; controls preload&gt;&lt;/audio&gt; 

&lt;hr&gt;

&lt;video id=&quot;video&quot; controls=&quot;&quot; preload=&quot;none&quot;  class=&quot;video_pos&quot; poster=&quot;http://media.w3.org/2010/05/sintel/poster.png&quot; &gt;
      &lt;source id=&quot;mp4&quot; src=&quot;http://media.w3.org/2010/05/sintel/trailer.mp4&quot; type=&quot;video/mp4&quot;&gt;
      &lt;source id=&quot;webm&quot; src=&quot;http://media.w3.org/2010/05/sintel/trailer.webm&quot; type=&quot;video/webm&quot;&gt;
      &lt;source id=&quot;ogv&quot; src=&quot;http://media.w3.org/2010/05/sintel/trailer.ogv&quot; type=&quot;video/ogg&quot;&gt;
      &lt;p&gt;Your user agent does not support the HTML5 Video element.&lt;/p&gt;
    &lt;/video&gt;

&lt;hr&gt;

&lt;hr&gt;

&lt;video id=&quot;video&quot; controls=&quot;&quot; preload=&quot;none&quot;  class=&quot;video_pos&quot; poster=&quot;/images/shot0004.png&quot; &gt;
      &lt;source id=&quot;mp4&quot; src=&quot;/images/the-godfather-speaksoftlylove.mp4&quot; type=&quot;video/mp4&quot;&gt;
      &lt;p&gt;Your user agent does not support the HTML5 Video element.&lt;/p&gt;
    &lt;/video&gt;
</description>
        <pubDate>Fri, 16 Oct 2015 04:06:05 +0800</pubDate>
        <link>//movie/test-plogin-mp3-mp4</link>
        <guid isPermaLink="true">//movie/test-plogin-mp3-mp4</guid>
        
        <category>movie</category>
        
        
        <category>movie</category>
        
      </item>
    
      <item>
        <title>linux问题小总结</title>
        <description>&lt;ol&gt;
&lt;li&gt;&lt;p&gt;已知oldboy.txt里面内容为：&lt;strong&gt;inet addr:10.0.0.8 Bcast:10.0.0.255 Mask:255.255.255.0&lt;/strong&gt; .现在只想打印出下面内容：　10.0.0.8 10.0.0.255 255.255.255.0。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;$ sed -nr &amp;#39;s#^.*dr:(.*) Bc.*:(.*) M.*k:(.*)#\1 \2 \3#gp&amp;#39; oldboy.txt
$ grep -Eo &amp;#39;[0-9.]+&amp;#39; oldboy.txt|xargs -n3
$ awk -F &amp;quot;[: ]&amp;quot; &amp;#39;{print $3, $5, $7}&amp;#39; oldboy.txt
$ ifconfig eth0|sed -rn &amp;#39;2s#^.*:([0-9.]+).*:([0-9.]+).*:([0-9.]+)$#\1 \2 \3#gp&amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;上使用awk取passwd文件的第10行到20行的第三列重定向到/tmp/oldboy/test.txt文件里。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;$ awk -F &amp;#39;:&amp;#39; ‘{if(NR&amp;gt;10 &amp;amp;&amp;amp; NR &amp;lt;21) print $3}’ /etc/passwd &amp;gt;/tmp/oldboy/test.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;禁止使用rm，并使该效果永久生效。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;$ echo alias rm=&amp;#39;echo &amp;quot;Do note use rm command&amp;quot;&amp;#39; &amp;gt;&amp;gt;/etc/profile
$ . /etc/profile
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;请用awk,grep,sed,head,tail分别取出passwd文件中的第2-5行&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;$ awk ‘{if(NR&amp;lt;6 &amp;amp;&amp;amp; NR&amp;gt;1 ) pirnt $0}’passwd
$ head -5 passwd | tail -4
$ sed –n ‘2,5p’passwd
$ grep ‘bin:x’-A4 passwd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;使用命令调换passwd文件里root位置和/bin/bash位置？即调换所有的第一列和最后一列位置调换？
例：默认：root:x:0:0:root:/root:/bin/bash. 修改后：/bin/bash:x:0:0:root:/root:root  &lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;$ sed -r &amp;#39;s#([^:]+)(:.*:)(/.*$)#\3 \2 \1 #g&amp;#39; /etc/passwd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;把/data目录及其子目录下所有以扩展名.txt结尾的文件中包含oldgirl的字符串全部替换为oldboy。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;$ Find /data –type f –name “*.txt” |xargs sed ‘s#oldboy#oldgirl#g’
$ sed -i ‘s#oldboy#oldgirl#g’ `find /data –name *.txt`
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;如何过滤出已知当前目录下oldboy中的所有一级目录(提示:不包含oldboy目录下面目录的子目录及隐藏目录，即只能是一级目录)？  &lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;方法一：&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;    $ ls -l |grep ^d
    drwxr-xr-x  2 sandow sandow 4096 Oct 13 06:13 Desktop
    drwxr-xr-x  2 sandow sandow 4096 Oct 11 07:41 Documents
    drwxr-xr-x  2 sandow sandow 4096 Oct  9 19:30 Downloads

    $ ls -F|grep /$
    Desktop/
    Documents/
    Downloads/          
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;方法二：&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;    $ find . -maxdepth 1 -type d ! -name &amp;quot;.&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;方法三:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;    $ tree -Ldi 1
    $ ls -l|sed -n &amp;#39;/^d/p&amp;#39;
    $ ls -l|awk &amp;#39;/^d/&amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;一个目录中有很多文件（ls -l 查看时好多屏），想用一条命令最快速度查看到最近更新的文件。如何看？  &lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;$ ls -lrt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;在配置apache时 执行了./configure --prefix=/application/apache2.2.17 来编译apche，在make 
install 完成后，希望用户访问 apache 路径更简单，需要给/application/apache2.2.17 目录做一个软链接/application/apache，使得内部开发或管理人员通过/application/apache 就可以访问到 apache 的安装目录/application/apache2.2.17 下的内容，请你给出实现的命令。（提示：apache 为一个 web 服务） &lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;$ ln –s /application/apache2.2.17 /application/apache
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;已知 apache 服务的访问日志按天记录在服务器本地目录/app/logs 下，由于磁盘空间紧张，现在要求只能保留最近 7 天的访问日志！请问如何解决？ 请给出解决办法或配置或处理命令。（提示：可以从 apache 服务配置上着手，也可以从生成出来的日志上着手。）&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;for n in `seq 15`
do
    date -s &amp;quot;2015/10/$n&amp;quot;
    touch access_www_`(date +%F)`.log
done

$ find /app/logs -type f -name &amp;quot;access*.log&amp;quot; -mtime +7 exec rm -f {} \;
$ find /app/logs -type f -name &amp;quot;access*.log&amp;quot; -mtime +7 |xargs rm -f
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;调试系统服务时，希望能实时查看/var/log/messages 系统日志的更新,如何做？  &lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;$ for n in `seq 19999`;do echo $n &amp;gt;&amp;gt;/var/log/messages;usleep 5000;done
$ tail -f /var/log/messages
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;打印轻量级 web 服务的配置文件 nginx.conf 内容的行号及内容，该如何做？&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;$ cat -n nginx.conf
$ less -N nginx.conf
$ awk &amp;#39;{print NR.$0}&amp;#39; nginx.conf
$ sed = nginx.conf| sed &amp;#39;N;s/\n/ /&amp;#39;
$ grep -n &amp;quot;.*&amp;quot; nginx.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;装完 Centos 系统后，希望网络文件共享服务 NFS，仅在 3 级别上开机自启动，该如何做？&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;$ chkconfig NFS –-level 3 on
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;/etc/目录为 linux 系统的默认的配置文件及服务启动命令的目录&lt;br&gt;
a.请用 tar 打包/etc 整个目录（打包及压缩）&lt;br&gt;
b.请用 tar 打包/etc 整个目录（打包及压缩，但需要排除/etc/services 文件）&lt;br&gt;
c.请把 a 点命令的压缩包，解压到/tmp 指定目录下（最好只用 tar 命令实现）  &lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;$ tar -zcvf a.tar /etc
$ find /etc/ ! -name /etc/services exec tar -cvf a.tar {} \;
$ cd /tmp &amp;amp;&amp;amp; tar –xvf a.tar 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;如何查看/etc/services 文件内容有多少行？&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;wc -l /etc/services
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;过滤出/etc/services 文件包含 3306 或 1521 两数据库端口的行的内容。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;$ grep -E &amp;quot;3306|1521&amp;quot; /etc/services
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;echo &amp;#39;i am oldboy myqq is 31333741&amp;#39; &amp;gt;&amp;gt;oldboy.txt取出oldboy, 31333741&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;awk &amp;quot;{print $3, $6}&amp;quot; oldboy.txt
cut -d &amp;quot; &amp;quot; -f3,6 oldboy.txt
cut -c 6-11, 20- oldboy.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
        <pubDate>Thu, 15 Oct 2015 02:06:05 +0800</pubDate>
        <link>//linux/somequestion-about-linux</link>
        <guid isPermaLink="true">//linux/somequestion-about-linux</guid>
        
        <category>command</category>
        
        
        <category>linux</category>
        
      </item>
    
      <item>
        <title>linux文件目录结构</title>
        <description>&lt;h2 id=&quot;linux-文件系统大览&quot;&gt;Linux 文件系统大览&lt;/h2&gt;

&lt;p&gt;linux下的所有的目录都是按照一定的类别有规律的组织和命名，每个目录数据可以跨越不同的磁盘分区或者不同的磁盘设备，所有目录都可以按两个类别来分：静态的与动态的，或者可共享的与不可共享的。可共享一个用户储存的文件可以被其它用户查看。静态的文件包括binaries, libraries, documenttation和其它在超级管理员不更改的情况下处于不变的文件。&lt;/p&gt;

&lt;table&gt;&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align: left&quot;&gt;&lt;/th&gt;
&lt;th style=&quot;text-align: left&quot;&gt;Shareable&lt;/th&gt;
&lt;th style=&quot;text-align: left&quot;&gt;unshareable&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;static&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;/usr&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;/etc&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;/opt&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;/boot&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;variable&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;/var/mail&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;/var/rum&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;/var/spool/news&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;/var/lock&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;Linux 系统的所有目录是一个有层次的倒着的树状目录结构，&amp;quot;／&amp;quot;  根是所有目录的起点可以用   &lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;$ tree -L 1 /
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align: center&quot;&gt;命令&lt;/th&gt;
&lt;th style=&quot;text-align: left&quot;&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;&lt;strong&gt;/bin&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Essential command binaries 存放着所有用户都可以用的二进制命令.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;&lt;strong&gt;/boot&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Static files of the boot loader 内核及系统引导程序所需的文件目录.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;&lt;strong&gt;/dev&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Device files.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;&lt;strong&gt;/etc&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Host-specific system configuration,配置文件的默认路径.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;&lt;strong&gt;/lib/lib64&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Essential shared libraries and kernel modules,库文件的目录.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;&lt;strong&gt;/lost+found&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;系统突然崩溃突然关机，系统产生的一些文件碎片在这里  fsck检查修复&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;&lt;strong&gt;/media&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Mount point for removeable media.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;&lt;strong&gt;/mnt&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Mount point for mounting a filesystem temporarily,文件系统的临时挂载点.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;&lt;strong&gt;/opt&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Add-on application software packages，可选的第三方软件的安装目录.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;&lt;strong&gt;/proc&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Kernel and process information virtual filesystem,内核与进程信息的虚拟文件系统.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;&lt;strong&gt;/root&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Home directory for the root user (optional), 超级管理员的家目录.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;&lt;strong&gt;/home&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;User home directories (optional)，普通用户的家目录.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;&lt;strong&gt;/sbin&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Essential system binaries,系统二进制命令文件.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;&lt;strong&gt;/srv&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Data for services provided by this system.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;&lt;strong&gt;/tmp&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Temporary files 临时文件存放目录.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;&lt;strong&gt;/usr&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Secondary hierarchy 第二层次结构, 存放系统程序以及用户安装程序的目录.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;&lt;strong&gt;/var&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Variable data 可变的数据.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;

&lt;hr&gt;

&lt;h3 id=&quot;一些简单的补充&quot;&gt;一些简单的补充&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;/bin  存放着一些所有用户都可以用的二进制命令
这个目录下面存放着的命令有：cat, chgrp, chmod, chown, cp, date, dd, df, dmesg, echo, false, hostaname, kill, ln, login, ls, mkdir, mknod, more, mount, mv, ps, pwd, rm, rmdir, sed, sh, stty, su, sync, true, umount, uname.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;/sbin 存放着只允许超级管理员才可以用的二进制命令，还可以存放在/usr/sbin /usr/local/sbin&lt;br&gt;
sbin 包含了一些系统启动，修复命令。&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;/boot 是linux 内核及系统引导程序所需的文件目录。安装系统分区时一般先分/boot 100－200M 可以用&lt;code&gt;du -sh /boot&lt;/code&gt;来查看大小  &lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;du -sh /boot
#39M     /boot
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr&gt;

&lt;h2 id=&quot;etc-host-specific-system-configuration&quot;&gt;/etc Host-specific system configuration&lt;/h2&gt;

&lt;p&gt;这个层次结构包含程序的配置文件，它必须是静态的不允许执行的二进制文件, 如果相应的子系统被安装，那么下面的文件或者符号链接必须在/etc下面  &lt;/p&gt;

&lt;table&gt;&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align: left&quot;&gt;File&lt;/th&gt;
&lt;th style=&quot;text-align: left&quot;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;csh.login&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Systemwide initialization file for C shell logins&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;exports&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;NFS filesystem access control list&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;fstab&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Static information about filesystems开机自动挂载文件&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;ftpusers&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;FTP daemon user access control list&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;gateways&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;File which lists gateways for routed&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;gettydefs&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Speed and terminal settings used by getty&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;group&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;User group file&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;host.conf&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Resolver configuration file&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;hosts&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Static information about host names&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;hosts.allow&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Host access file for TCP wrappers&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;hosts.deny&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Host access file for TCP wrappers&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;hosts.equiv&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;List of trusted hosts for rlogin, rsh, rcp&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;hosts.lpd&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;List of trusted hosts for lpd&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;inetd.conf&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Configuration file for inetd&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;inittab&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Configuration file for init&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;issue&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Pre-login message and identification file&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;ld.so.conf&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;List of extra directories to search for shared libraries&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;motd&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Post-login message of the day file 文件&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;mtab&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Dynamic information about filesystems&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;mtools.conf&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Configuration file for mtools&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;networks&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Static information about network names&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;passwd&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;The password file&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;printcap&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;The lpd printer capability database&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;profile&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Systemwide initialization file for sh shell logins 全局的环境变量配置文件&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;protocols&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;IP protocol listing&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;resolv.conf&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Resolver configuration file&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;rpc&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;RPC protocol listing&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;securetty&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;TTY access control for root login&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;services&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Port names for network services&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;shells&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Pathnames of valid login shells&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;syslog.conf&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Configuration file for syslogd&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;rc.local&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;用于存放开机自启动程序命令的文件。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;basrc&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;对所有用户生效的全局变量&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;

&lt;hr&gt;

&lt;h2 id=&quot;the-var-hierarchy&quot;&gt;The /var Hierarchy&lt;/h2&gt;

&lt;p&gt;/var　下面存放着可变的数据文件，他们包括spool directories，administrative and logging data, transient and temporary files. /var下面的文件有些是可共享的比如/var/mail, /var/cache/man,/var/cache/fonts, /var/spool/news,有些是不可共享的：/var/log, /var/lock, /var/run.   &lt;/p&gt;

&lt;p&gt;　　/var is specified here in order to make it possible to mount /usr read-only. Everything that once went into /usr that is written to during system operation (as opposed to installation and software maintenance) must be in /var.&lt;br&gt;
  　If /var cannot be made a separate partition, it is often preferable to move /var out of the root partition and into the /usr partition. (This is sometimes done to reduce the size of the root partition or when space runs low in the root partition.) However, /var must not be linked to /usr because this makes separation of /usr and /var　more difficult and is likely to create a naming conflict. Instead, link /var to /usr/var.&lt;br&gt;
　　Applications must generally not add directories to the top level of /var. Such directories should only be added if　they have some system-wide implication, and in consultation with the FHS mailing list.  &lt;/p&gt;

&lt;table&gt;&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align: left&quot;&gt;Directory&lt;/th&gt;
&lt;th style=&quot;text-align: left&quot;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;cache&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Application cache data 应用程序缓存数据。这些数据是在本地生成的一个耗时的I/O或计算结果。应用程序必须能够再生或恢复数据。缓存的文件可以被删除而不导致数据丢失。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;lib&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Variable state information 系统正常运行时要改变的文件.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;local&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Variable data for /usr/local&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;lock&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Lock files&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;log&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Log files and directories 各种程序的Log文件，特别是login   (/var/log/wtmp log所有到系统的登录和注销) 和syslog (/var/log/messages 里存储所有核心和系统程序信息. /var/log 里的文件经常不确定地增长，应该定期清除.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;log/lastlog&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;record of last login of each user&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;log/messages&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;system messages from syslogd 日志信息，按周自动轮询&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;log/wtmp&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;record of all logins and logouts&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;log/secure&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;记录登陆系统存取信息的文件，不管认证成功还是认证失败都会记录&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;opt&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Variable data for /opt&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;run&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Data relevant to running processes保存到下次引导前有效的关于系统的信息文件.例如， /var/run/utmp 包含当前登录的用户的信息.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;spool&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Application spool data&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;tmp&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;Temporary files preserved between system reboots&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;

&lt;hr&gt;

&lt;h3 id=&quot;log　文件下的文件详细介绍&quot;&gt;log　文件下的文件详细介绍&lt;/h3&gt;

&lt;table&gt;&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align: left&quot;&gt;Directory&lt;/th&gt;
&lt;th style=&quot;text-align: left&quot;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;messages&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;包括整体系统信息，其中也包含系统启动期间的日志。此外mail, cron, daemon, kern和auth等内容也记录在messages日志中。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;dmesg&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;包含内核缓冲信息（kernel ring buffer）。在系统启动时，会在屏幕上显示许多与硬件有关的信息。可以用dmesg查看它们。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;auth.log&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;包含系统授权信息，包括用户登录和使用的权限机制等。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;boot.log&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;包含系统启动时的日志。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;daemon.log&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;包含各种系统后台守护进程日志信息。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;dpkg.log&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;包括安装或dpkg命令清除软件包的日志。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;kern.log&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;包含内核产生的日志，有助于在定制内核时解决问题。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;lastlog&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;记录所有用户的最近信息。这不是一个ASCII文件，因此需要用lastlog命令查看内容&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;user.log&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;记录所有等级用户信息的日志。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;alternatives.log&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;更新替代信息都记录在这个文件中。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;btmp&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;记录所有失败登录信息。使用last命令可以查看btmp文件。例如，”last -f /var/log/btmp \&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;anaconda.log&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;在安装Linux时，所有安装信息都储存在这个文件中。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;secure&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;包含验证和授权方面信息。例如，sshd会将所有信息记录（其中包括失败登录）在这里。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;wtmp ,utmp&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;包含登录信息。使用wtmp可以找出谁正在登陆进入系统，谁使用命令显示这个文件或信息等。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;faillog&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;包含用户登录失败信息。此外，错误登录命令也会记录在本文件中。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;

&lt;hr&gt;

&lt;h2 id=&quot;dev-devices-and-special-files&quot;&gt;/dev : Devices and special files&lt;/h2&gt;

&lt;p&gt;The following devices must exist under /dev.&lt;/p&gt;

&lt;table&gt;&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align: left&quot;&gt;Directory&lt;/th&gt;
&lt;th style=&quot;text-align: left&quot;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;null&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;All data written to this device is discarded. A read from this device will return an EOF condition.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;zero&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;This device is a source of zeroed out data. All data written to this device is discarded. A read from this device will return as many bytes containing the value zero as was requested.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;tty&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;This device is a synonym for the controlling terminal of a process. Once this device is opened, all reads and writes will behave as if the actual controlling terminal device had been opened.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;

&lt;h3 id=&quot;普及硬盘的基础知识&quot;&gt;普及硬盘的基础知识&lt;/h3&gt;

&lt;p&gt;　　　 在linux下面每个设备都被当成一个文件来对待，因硬盘接口的不同对应于/dev下面的文件名也不同下面表格可以拿来参考对照&lt;/p&gt;

&lt;table&gt;&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align: left&quot;&gt;设备　&lt;/th&gt;
&lt;th style=&quot;text-align: left&quot;&gt;设备在linux内的文件名&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;IDE硬盘　　　　　　　　&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;/dev/hd[a-d]&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;scsi, stat, usb硬盘&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;/dev/sd[a-p]&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;U盘　　　　　　&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;/dev/sd[a-p]&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;软驱&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;/dev/fd[0-1]&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;CD ROM&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;/dev/cdrom&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;　　硬盘由许多盘片，机械手臂，磁头与主轴马达所组成，实际的数据都写在盘片上，　而读写主要通过机械手臂可伸展让读取头在盘片上面进行读写操作. 盘片上，以圆心以放射状的方式分割出最小的存储单位叫扇区(sector)，每个扇区512bytes,扇区所组成的圆叫磁道（track)，在所胡盘片上面的同一个磁道可以组成柱面(cylinder)，柱面也是一般我们分割硬盘的最小单位了。硬盘大小计算方式 head * cylinder * sector * 512 bytes&lt;br&gt;
　　　　
    每个硬盘的第一扇区都非常重要，主要记录了两个重要的信息：主引导分区(master boot record, MBR)，可以安装引导加载程序的地方，有446bytes。　分区表（partiion table），记录了整块硬盘分区的状态有64bytes,因为只有６４bytes所以只能存放４个分区，这四个分区被称为主(primary)分区或者扩展(extended)分区,　而扩展分区本身不不能被拿来格式化，可以在扩展分区上继续做分区，这些分区被称为逻辑(logical）分区。在linux系统中对应的文件名前四个预留给主分区或者扩展分区，逻辑分区必须从５开始，如图&lt;br&gt;
&lt;img src=&quot;/images/deviec-partition.png&quot; alt=&quot;device partition&quot;&gt;&lt;br&gt;
这里p1对应linux文件中的 /dev/hda1。 p2对应 /dev/hda2。 l1　对应 /dev/hda5。 l2　对应 /dev/hda6 等。&lt;/p&gt;

&lt;p&gt;　　在/dev里面的设备，系统里的设备默认情况是无法访问的，需要进行挂载才可访问，比如如果需要访问/dev/sda1,就需要用一个入口与之关联,比如关联到／mnt 便需要用mount命令把sda1挂载到/mnt  &lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;mount -t ext4 /dev/sda1 /mnt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这里/mnt被挂载的目录就叫挂载点可以用 &lt;code&gt;df -h&lt;/code&gt; 来查看系统的分区情况,可以是通过配置/etc/fstab实现开机自动挂载  &lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;df -h
#Filesystem      Size  Used Avail Use% Mounted on
#/dev/sda3       6.6G  1.7G  4.6G  28% /
#tmpfs           491M     0  491M   0% /dev/shm
#/dev/sda1       190M   40M  141M  22% /boot
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如果需要取消挂载，便可以用 &lt;code&gt;umount&lt;/code&gt; 命令. 这里需要退出到/mnt后才能操作&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;umount /mnt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;/proc     内核与进程信息的的虚拟文件系统
     /proc/meminfo
     /proc/cpuinfo&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;     /proc/loadavg
     内核：/proc/sys/net/ipv4/ip_forward对应/etc/sysctl.conf里的配置。
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;/var/spool/crom/root  定时任务的配置文件
/var/spool/clientmpqueue &lt;/p&gt;

&lt;p&gt;/proc/sys/net/ipv4&lt;/p&gt;
</description>
        <pubDate>Wed, 14 Oct 2015 00:00:00 +0800</pubDate>
        <link>//linux/linux-filesystem</link>
        <guid isPermaLink="true">//linux/linux-filesystem</guid>
        
        <category>command</category>
        
        <category>linux</category>
        
        
        <category>linux</category>
        
      </item>
    
  </channel>
</rss>